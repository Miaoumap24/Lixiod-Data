<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Mon WYSIWYG Trop Bien</title>
    <style>
        /* Styles de base et du corps */
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f7f9fc; /* Arri√®re-plan tr√®s doux */
        padding: 20px;
        margin: 0;
    }

    /* Styles pour les toolbars (barres d'outils) */
    .toolbar {
        padding: 10px;
        display: flex;
        flex-wrap: wrap; 
        gap: 10px;
        border-radius: 8px;
        margin-bottom: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    /* Toolbar statique (Ajouter un bloc) - Rose doux */
    #static-toolbar {
        background-color: #ffe0e6;
    }

    /* Toolbar dynamique (√âdition) - Jaune doux */
    #dynamic-toolbar {
        background-color: #fce172;
    }

    /* Classe pour masquer les toolbars */
    .hidden {
        display: none !important;
    }

    /* Styles des boutons */
    .tool-button {
        cursor: pointer;
        padding: 8px 12px;
        border: 2px solid transparent;
        border-radius: 6px;
        background-color: #a8dadc; /* Bleu-vert doux */
        color: #1d3557;
        font-weight: bold;
        transition: all 0.2s ease-in-out;
    }

    .tool-button:hover {
        background-color: #457b9d;
        color: white;
        border-color: #457b9d;
        transform: translateY(-1px);
    }

    /* Bouton d'exportation pour le faire ressortir */
    .export-button {
        background-color: #e63946; /* Rouge */
        color: white;
        margin-left: auto; /* Le pousse vers la droite */
    }
    .export-button:hover {
        background-color: #c72c38;
        border-color: #c72c38;
    }


    /* Le conteneur principal de l'√©diteur */
    #editor {
        min-height: 500px;
        border: 2px dashed #a8dadc;
        padding: 20px;
        background-color: white;
        border-radius: 8px;
        transition: border-color 0.3s;
    }

    /* Styles des blocs de texte */
    .text-block {
        margin: 15px 0;
        padding: 10px;
        font-size: 16px;
        line-height: 1.6;
        border: 1px solid transparent;
        transition: border 0.2s, background-color 0.2s;
        cursor: move; /* Indique qu'il est d√©pla√ßable */
        outline: none;
    }

    /* Effet au survol des blocs */
    .text-block:hover {
        border: 1px dashed #457b9d;
        background-color: #f0f8ff;
    }

    /* Style du bloc actif (en mode √©dition) */
    .text-block.active {
        border: 2px solid #457b9d; 
        background-color: #ffffff;
    }
    
    /* Glisser-D√©poser: Style pour le bloc en cours de glissement (visuel) */
    .text-block.dragging {
        opacity: 0.4;
        border: 2px dashed #e63946 !important;
    }

    /* Glisser-D√©poser: Style pour l'endroit o√π le bloc va √™tre d√©pos√© */
    .drag-over {
        border-top: 3px solid #1d3557 !important; 
    }
    </style>
</head>

<body>

    <div id="dynamic-toolbar" class="toolbar hidden">
        <button class="tool-button" id="back-btn">Retour ‚¨ÖÔ∏è</button>

        <button class="tool-button" data-command="bold">Gras üÖ±Ô∏è</button>
        <button class="tool-button" data-command="italic">Italique üáÆ</button>
        <button class="tool-button" data-command="underline">Soulign√© üá∫</button>
        <button class="tool-button" data-command="createLink">Lien üîó</button>

        <select class="tool-select" data-command="fontName" id="font-select">
            <option value="">Police</option>
            <option value="Arial">Arial</option>
            <option value="Georgia">Georgia</option>
            <option value="Verdana">Verdana</option>
            <option value="Comic Sans MS">Comic Sans MS (Pour le fun !)</option>
        </select>

        <select class="tool-select" data-command="fontSize" id="size-select">
            <option value="">Taille</option>
            <option value="3">Petit</option>
            <option value="5">Moyen</option>
            <option value="7">Grand</option>
        </select>
        
        <label for="color-input" class="tool-label">Couleur üé®</label>
        <input type="color" class="tool-color" data-command="foreColor" id="color-input" value="#000000">


        <button class="tool-button export-button" id="export-btn">Exporter üì¶</button>
    </div>

    <div id="editor">
        </div>

    <script>
         // R√©f√©rences aux √©l√©ments du DOM
    const editor = document.getElementById('editor');
    const staticToolbar = document.getElementById('static-toolbar');
    const dynamicToolbar = document.getElementById('dynamic-toolbar');
    const addTextBtn = document.getElementById('add-text-btn');
    const backBtn = document.getElementById('back-btn');
    const exportBtn = document.getElementById('export-btn');

    let activeBlock = null; // Variable pour suivre le bloc actuellement en √©dition
    let dragElement = null; // Variable pour l'√©l√©ment qu'on est en train de glisser

    // ----------------------------------------------------------------------
    // 1. GESTION DE L'AFFICHAGE DES TOOLBARS ET DES BLOCS
    // ----------------------------------------------------------------------

    function enterEditMode(block) {
        if (activeBlock) {
            activeBlock.classList.remove('active');
            activeBlock.contentEditable = 'false';
        }

        // Active le nouveau bloc
        activeBlock = block;
        activeBlock.classList.add('active');
        activeBlock.contentEditable = 'true';
        activeBlock.focus();

        // Change les barres d'outils
        staticToolbar.classList.add('hidden');
        dynamicToolbar.classList.remove('hidden');
    }

    function exitEditMode() {
        if (activeBlock) {
            activeBlock.contentEditable = 'false';
            activeBlock.classList.remove('active');
            activeBlock = null;
        }
        // Change les barres d'outils
        dynamicToolbar.classList.add('hidden');
        staticToolbar.classList.remove('hidden');
    }

    // ----------------------------------------------------------------------
    // 2. √âV√âNEMENTS STATIQUES (Ajouter / Clic Bloc / Retour)
    // ----------------------------------------------------------------------

    // Ajout d'un nouveau bloc de texte
    addTextBtn.addEventListener('click', () => {
        const newBlock = document.createElement('p');
        newBlock.classList.add('text-block');
        newBlock.textContent = 'Nouveau texte g√©nial !'; 
        newBlock.setAttribute('draggable', 'true'); // Rendre le nouveau bloc d√©pla√ßable
        
        editor.appendChild(newBlock);
        
        enterEditMode(newBlock);
    });

    // √âcouter les clics dans l'√©diteur pour passer en mode √©dition
    editor.addEventListener('click', (event) => {
        if (event.target.classList.contains('text-block')) {
            enterEditMode(event.target);
        }
    });

    // Bouton "Retour" pour sortir du mode √©dition
    backBtn.addEventListener('click', exitEditMode);

    // ----------------------------------------------------------------------
    // 3. √âV√âNEMENTS DYNAMIQUES (Gras, Italique, etc. via execCommand)
    // ----------------------------------------------------------------------

    dynamicToolbar.addEventListener('click', (event) => {
        const target = event.target;
        // On v√©rifie que c'est un bouton d'outil et qu'on n'est pas sur "Retour" ou "Exporter"
        if (target.classList.contains('tool-button') && target.id !== 'back-btn' && target.id !== 'export-btn') {
            const command = target.dataset.command;
            
            if (command) {
                // Gestion sp√©ciale pour createLink (demande une URL)
                if (command === 'createLink') {
                    const url = prompt("Entre l'URL du lien (ex: https://www.google.com) :");
                    if (url) {
                         document.execCommand('createLink', false, url);
                    }
                } else {
                    document.execCommand(command, false, null);
                }
                
                activeBlock.focus(); // Garde le focus pour continuer √† taper
            }
        }
    });

    // ----------------------------------------------------------------------
    // 4. GESTION DU GLISSER-D√âPOSER (DRAG AND DROP)
    // ----------------------------------------------------------------------

    editor.addEventListener('dragstart', (event) => {
        if (event.target.classList.contains('text-block')) {
            exitEditMode(); 
            
            dragElement = event.target;
            dragElement.classList.add('dragging');
            event.dataTransfer.effectAllowed = 'move';
            event.dataTransfer.setData('text/html', event.target.innerHTML);
        }
    });

    editor.addEventListener('dragend', (event) => {
        if (dragElement) {
            dragElement.classList.remove('dragging');
            dragElement = null;
        }
        document.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));
    });

    editor.addEventListener('dragover', (event) => {
        event.preventDefault(); 
        event.dataTransfer.dropEffect = 'move';

        const target = event.target;
        document.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));
        
        if (target.classList.contains('text-block') && target !== dragElement) {
            const rect = target.getBoundingClientRect();
            const middleY = rect.top + rect.height / 2;
            
            if (event.clientY < middleY) {
                target.classList.add('drag-over');
            } else {
                if (target.nextElementSibling && target.nextElementSibling.classList.contains('text-block')) {
                    target.nextElementSibling.classList.add('drag-over');
                } else {
                    target.classList.add('drag-over');
                }
            }
        }
    });

    editor.addEventListener('drop', (event) => {
        event.preventDefault();
        document.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));

        if (dragElement && event.target.classList.contains('text-block') && event.target !== dragElement) {
            const target = event.target;
            const rect = target.getBoundingClientRect();
            const middleY = rect.top + rect.height / 2;

            if (event.clientY < middleY) {
                editor.insertBefore(dragElement, target);
            } else {
                editor.insertBefore(dragElement, target.nextSibling);
            }
        }
    });

    // ----------------------------------------------------------------------
    // 5. GESTION DU BOUTON EXPORTER
    // ----------------------------------------------------------------------

    exportBtn.addEventListener('click', () => {
        exitEditMode(); // S'assurer qu'on n'est plus en √©dition
        
        // On r√©cup√®re uniquement le HTML des blocs d√©pla√ßables pour l'export
        const blocksHTML = Array.from(editor.children)
            .filter(el => el.classList.contains('text-block'))
            .map(el => el.outerHTML)
            .join('\n');
            
        const exportContent = `<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Page Export√©e de Mon √âditeur Trop Bien</title>
</head>
<body>
    ${blocksHTML}
</body>
</html>`;

        const blob = new Blob([exportContent], { type: 'text/html' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'page_editor_timeo.html';
        
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);

        alert("Fichier HTML export√© avec succ√®s ! Tu g√®res ! üéâ");
    });
    </script>
</body>
    
</html>
